{% extends "base.html" %}

{% block title %}{{ user.username }} 的个人主页 - 环球旅记{% endblock %}

{% block styles %}
<style>
    .profile-header {
        background-color: #f8f9fa;
        border-radius: 12px;
        overflow: hidden;
    }
    
    .profile-cover {
        height: 200px;
        background-image: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
        background-size: cover;
        background-position: center;
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        border: 4px solid white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        margin-top: -60px;
        position: relative;
        z-index: 2;
    }
    
    .social-stat {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .social-stat:hover {
        background-color: #f1f5f9;
    }
    
    .post-card {
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .post-image {
        height: 180px;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .post-card:hover .post-image {
        transform: scale(1.05);
    }
    
    .tab-btn {
        color: #64748b;
        font-weight: 500;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
        background-color: #f1f5f9;
    }
    
    .tab-btn.active {
        color: #3498db;
        background-color: rgba(52, 152, 219, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 md:px-8 py-8">
    <!-- 个人资料头部 -->
    <div class="profile-header mb-8 shadow-sm">
        <div class="profile-cover" {% if user.cover_image %}style="background-image: url({{ url_for('static', filename='uploads/covers/' + user.cover_image) }})"{% endif %}></div>
        
        <div class="px-6 py-4 pb-6">
            <div class="flex flex-col md:flex-row">
                <div class="text-center md:text-left">
                    {% if user.avatar_url %}
                    <img src="{{ url_for('static', filename='uploads/profiles/' + user.avatar_url) }}" alt="{{ user.username }}" class="profile-avatar rounded-full object-cover mx-auto md:mx-0">
                    {% else %}
                    <img src="{{ url_for('static', filename='img/default_avatar.png') }}" alt="{{ user.username }}" class="profile-avatar rounded-full object-cover mx-auto md:mx-0">
                    {% endif %}
                    
                    <div class="mt-4 md:mt-6">
                        <h1 class="text-2xl font-bold text-gray-800">{{ user.username }}</h1>
                        <p class="text-gray-600">
                            <i class="fas fa-map-marker-alt text-primary mr-1"></i>
                            {% if user.location %}{{ user.location }}{% else %}未设置位置{% endif %}
                        </p>
                        <p class="text-gray-500 text-sm mt-1">
                            <i class="far fa-calendar-alt mr-1"></i> 加入于 {{ user.created_at.strftime('%Y-%m-%d') }}
                        </p>
                    </div>
                </div>
                
                <div class="flex-1 mt-6 md:mt-0 md:ml-8">
                    {% if user.bio %}
                    <div class="bg-white p-4 rounded-lg shadow-sm mb-4">
                        <h3 class="text-lg font-semibold mb-2">关于我</h3>
                        <p>{{ user.bio }}</p>
                    </div>
                    {% endif %}
                    
                    <div class="flex flex-wrap justify-center md:justify-start mt-4">
                        <div class="social-stat text-center">
                            <div class="text-2xl font-bold text-gray-800">{{ posts_count }}</div>
                            <div class="text-gray-600 text-sm">旅行故事</div>
                        </div>
                        <div class="social-stat text-center">
                            <div class="text-2xl font-bold text-gray-800">{{ bookmarks_count }}</div>
                            <div class="text-gray-600 text-sm">收藏</div>
                        </div>
                        <div class="social-stat text-center">
                            <div class="text-2xl font-bold text-gray-800">{{ comments_count }}</div>
                            <div class="text-gray-600 text-sm">评论</div>
                        </div>
                    </div>
                </div>
                
                {% if current_user.is_authenticated and current_user.id == user.id %}
                <div class="mt-6 md:mt-0 flex justify-center md:justify-end items-start">
                    <a href="{{ url_for('auth.profile') }}" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all">
                        <i class="fas fa-edit mr-1"></i> 编辑个人资料
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- 内容标签页 -->
    <div class="mb-6 border-b border-gray-200">
        <div class="flex flex-wrap">
            <a href="{{ url_for('main.user_profile', username=user.username) }}" class="tab-btn {% if request.endpoint == 'main.user_profile' %}active{% endif %}">
                <i class="fas fa-user mr-2"></i> 个人主页
            </a>
            <a href="{{ url_for('main.user_posts', username=user.username) }}" class="tab-btn {% if request.endpoint == 'main.user_posts' %}active{% endif %}">
                <i class="fas fa-pen-nib mr-2"></i> 旅行故事
            </a>
            {% if current_user.is_authenticated and current_user.id == user.id %}
            <a href="{{ url_for('main.user_bookmarks') }}" class="tab-btn {% if request.endpoint == 'main.user_bookmarks' %}active{% endif %}">
                <i class="fas fa-bookmark mr-2"></i> 我的收藏
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- 最近的旅行故事 -->
    {% if recent_posts %}
    <section class="mb-12">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-gray-800">最近的旅行故事</h2>
            <a href="{{ url_for('main.user_posts', username=user.username) }}" class="text-primary hover:underline">查看全部</a>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for post in recent_posts %}
            <div class="post-card bg-white rounded-xl overflow-hidden shadow-sm">
                <div class="relative overflow-hidden">
                    {% if post.featured_image %}
                    <img src="{{ url_for('static', filename='uploads/posts/' + post.featured_image) }}" alt="{{ post.title }}" class="post-image w-full">
                    {% else %}
                    <img src="{{ url_for('static', filename='img/default-post.jpg') }}" alt="{{ post.title }}" class="post-image w-full">
                    {% endif %}
                    
                    {% if post.location %}
                    <div class="absolute bottom-3 left-3 bg-white/80 backdrop-blur-sm text-sm font-medium py-1 px-3 rounded-full">
                        <i class="fas fa-map-marker-alt text-primary mr-1"></i> {{ post.location }}
                    </div>
                    {% endif %}
                </div>
                
                <div class="p-4">
                    <h3 class="text-lg font-bold mb-2 line-clamp-1">{{ post.title }}</h3>
                    <p class="text-gray-600 mb-3 line-clamp-2">{{ post.content|striptags }}</p>
                    
                    <div class="flex justify-between items-center text-sm mt-3 pt-3 border-t border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span class="flex items-center text-gray-500">
                                <i class="far fa-eye mr-1"></i> {{ post.views }}
                            </span>
                            <span class="flex items-center text-gray-500">
                                <i class="far fa-comment mr-1"></i> {{ post.comment_count() }}
                            </span>
                        </div>
                        
                        <a href="{{ url_for('main.post', post_id=post.id) }}" class="text-primary hover:underline font-medium">
                            阅读全文
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <div class="bg-white rounded-lg p-8 text-center shadow-sm mb-8">
        <div class="text-5xl text-gray-300 mb-4">
            <i class="far fa-newspaper"></i>
        </div>
        <h3 class="text-xl font-medium text-gray-600 mb-2">暂无旅行故事</h3>
        <p class="text-gray-500 mb-4">这位用户还没有分享任何旅行故事</p>
        
        {% if current_user.is_authenticated and current_user.id == user.id %}
        <a href="{{ url_for('main.create_post') }}" class="inline-block bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all">
            <i class="fas fa-plus mr-2"></i> 分享旅行故事
        </a>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- 常去的目的地 -->
    {% if popular_locations %}
    <section class="mb-12">
        <h2 class="text-xl font-bold text-gray-800 mb-6">常去的目的地</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {% for location in popular_locations %}
            <div class="bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-all">
                <div class="p-4">
                    <div class="flex items-center">
                        <i class="fas fa-map-marker-alt text-primary mr-3 text-lg"></i>
                        <div>
                            <h3 class="font-medium">{{ location.name }}</h3>
                            <p class="text-sm text-gray-500">{{ location.count }} 篇故事</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %} 