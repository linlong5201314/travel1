{% extends "base.html" %}

{% block title %}编辑旅行故事 - 环球旅记{% endblock %}

{% block content %}
<!-- 页面标题 -->
<div class="bg-gray-50 py-12 mb-8">
    <div class="container mx-auto px-4">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-dark mb-3">编辑旅行故事</h1>
        <p class="text-center text-gray-600 max-w-3xl mx-auto">更新您的旅行经历、见闻和感受</p>
    </div>
</div>

<!-- 表单内容 -->
<div class="container mx-auto px-4 max-w-4xl mb-16">
    <div class="bg-white rounded-xl shadow-md p-6 md:p-8">
        <form method="POST" enctype="multipart/form-data">
            {{ form.csrf_token }}
            
            <div class="mb-6">
                <label for="title" class="block text-sm font-medium text-gray-700 mb-1">标题</label>
                {{ form.title(class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder="一个吸引人的标题（例如：探索巴厘岛的隐秘海滩）") }}
                {% if form.title.errors %}
                <div class="text-red-500 text-sm mt-1">
                    {% for error in form.title.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <div class="mb-6">
                <label for="location" class="block text-sm font-medium text-gray-700 mb-1">地点</label>
                {{ form.location(class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder="您旅行的地点（例如：巴厘岛，印度尼西亚）") }}
                {% if form.location.errors %}
                <div class="text-red-500 text-sm mt-1">
                    {% for error in form.location.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <div class="mb-6">
                <label for="featured_image" class="block text-sm font-medium text-gray-700 mb-1">封面图片</label>
                {% if post.featured_image %}
                <div class="mb-3">
                    <p class="text-sm text-gray-600 mb-2">当前图片:</p>
                    <img src="{{ url_for('static', filename='uploads/posts/' + post.featured_image) }}" alt="{{ post.title }}" class="w-40 h-30 object-cover rounded-lg">
                </div>
                {% endif %}
                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-lg">
                    <div class="space-y-1 text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <div class="flex text-sm text-gray-600">
                            <label for="featured_image" class="relative cursor-pointer bg-white rounded-md font-medium text-primary hover:text-primary-dark">
                                <span>上传新图片</span>
                                {{ form.featured_image(class="sr-only", id="featured_image") }}
                            </label>
                            <p class="pl-1">或拖放图片到此处</p>
                        </div>
                        <p class="text-xs text-gray-500">PNG, JPG, GIF 最大 10MB</p>
                        <p class="text-xs text-gray-500 mt-1">如不上传新图片，将保留当前图片</p>
                        {% if form.featured_image.errors %}
                        <div class="text-red-500 text-xs mt-1">
                            {% for error in form.featured_image.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <label for="images" class="block text-sm font-medium text-gray-700 mb-1">附加照片 (可多选)</label>
                <input type="file" id="images" name="images" multiple accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                <div id="preview" class="grid grid-cols-3 gap-4 mt-4"></div>
            </div>
            
            <div class="mb-6">
                <label for="content" class="block text-sm font-medium text-gray-700 mb-1">内容</label>
                {{ form.content(rows=12, class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent", placeholder="分享您的旅行经历、见闻和感受...") }}
                {% if form.content.errors %}
                <div class="text-red-500 text-sm mt-1">
                    {% for error in form.content.errors %}
                    <span>{{ error }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <div class="flex justify-between">
                <a href="{{ url_for('main.post', post_id=post.id) }}" class="border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 px-6 py-2 rounded-lg font-medium transition-all">
                    取消
                </a>
                {{ form.submit(class="bg-primary hover:bg-primary/90 text-white px-8 py-3 rounded-lg font-medium transition-all hover:shadow-lg", value="更新旅行故事") }}
            </div>
        </form>
    </div>
</div>

{% block scripts %}
{{ super() }}
<script>
  document.getElementById('images').addEventListener('change', function(e){
      const preview=document.getElementById('preview');
      preview.innerHTML='';
      Array.from(this.files).forEach(file=>{
          if(!file.type.startsWith('image/')) return;
          const reader=new FileReader();
          reader.onload=ev=>{
             const img=document.createElement('img');
             img.src=ev.target.result;
             img.className='w-full h-24 object-cover rounded';
             preview.appendChild(img);
          };
          reader.readAsDataURL(file);
      });
  });
</script>
{% endblock %}
{% endblock %} 